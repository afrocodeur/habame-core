var Habame=function(){"use strict";const t=function(){const t=this,e={};this.emit=function(t,n){e[t]&&e[t].forEach((t=>{n=n||[],t.apply(t,n)}))},this.create=function(e){const n={emit:function(){t.emit(e,Array.from(arguments))}};return void 0!==this[e]?null:(Object.defineProperty(this,e,{get:()=>n}),n)},this.disconnect=function(){for(const t in e)e[t].splice(0)},this.addEventListener=function(t,n){return"function"!=typeof n?null:(e[t]=e[t]||[],e[t].push(n),n)},this.on=this.addEventListener,this.removeEventListener=function(t,n){if(void 0===e[t])return;const o=e[t],r=o.indexOf(n);r<0||o.splice(r,1)},this.clearAll=function(){for(const t in e)e[t].splice()}},e=["push","pop","shift","unshift","sort","reverse","splice"],n=function(t,n){if(!t||"object"!=typeof t||!n)return;let o=[];o=Array.isArray(t)?e:t.MUTATORS||o,t.ORIGINAL_METHODS=t.ORIGINAL_METHODS||{},o.forEach((e=>{const o=t.ORIGINAL_METHODS[e]||t[e];t[e]=function(){const e=o.apply(t,Array.from(arguments));return n.trigger(),e}}))},o=function(t,e){n(t,this);const o={default:t,current:t,last:t},r=[],i=()=>{e&&e.isSwitchOff()||r.forEach((t=>{t.apply(t,[o.current,o.last])}))};this.set=function(t,e=!0){return t!==o.current&&(o.last=o.current,n(t),o.current=t,e&&i(),!0)},this.value=function(){return o.current},this.getLastValue=function(){return o.last},this.getInitialValue=function(){return o.default},this.onUpdate=function(t){return r.push(t),t},this.watch=this.onUpdate,this.trigger=function(){i()},this.disconnect=function(t){const e=r.indexOf(t);e<0||r.splice(e,1)},this.reset=function(){this.set(o.default)}},r=function(t={},e={}){const n=e=>{this[e]=t[e].value()},o=()=>{for(const e in t)["onUpdate","all","getSlot"].includes(e)||n(e)};this.exists=function(e){return Object.keys(t).includes(e)},this.add=function(e,r){this.exists(e)||(t[e]=r,r.onUpdate(o),n(e))},this.onUpdate=function(e,n){if(void 0===t[e])throw new Error("undefined props "+e);return t[e].onUpdate(n),{disconnect:function(){t[e].disconnect(n)}}},this.disconnect=function(e,n){t[e]?.disconnect(n)},this.all=function(){const e={};for(const n in t)e[n]=t[n].value();return e},this.getSlot=function(t){return e?e[t]:null},this.updateSlots=function(t){e=t},this.getTemplate=function(e){return t[e]},(()=>{o();for(const e in t)t[e].onUpdate(o)})()},i=function(t={}){const e={},n=[],s={enable:!0,listenersToHandle:new Set},c={props:null,callbacks:{}},u=t=>{s.enable&&n.forEach((({names:e,listener:n})=>{if(!e)return;e.some((e=>t.includes(e)))&&n.apply(n,[])}))};this.add=function(t,n){if(e[t])return e[t];const r=new o(n,this);return r.onUpdate((()=>u([t]))),e[t]=r,Object.defineProperty(this,t,{configurable:!0,get:()=>r.value(),set(t){r.set(t)}}),r},this.switchOff=function(){s.enable=!1},this.isSwitchOff=function(){return!1===s.enable},this.switchOn=function(){s.enable=!0;const t=[...s.listenersToHandle];s.listenersToHandle.clear(),t.forEach((({state:t,variables:e})=>t.trigger(e)))},this.init=function(t){for(const e in t)this.add(e,t[e])},this.useProps=function(t,e=null){if(!(t instanceof r))throw new Error("State.useProps require a ComponentProps instance");c.props=t;const n=t.all();for(const o in n){if(Array.isArray(e)&&!e.includes(o))continue;if(c.callbacks[o])return;const r=this.add(o,n[o]);c.callbacks[o]=t.onUpdate(o,((t,e)=>{r.set(t),t===e&&r.trigger()}))}},this.disconnectProps=function(t){if(!c)return;let e=[...t];if(!t||0===t.length){const t=c.props.all();e=Object.keys(t)}e.forEach((function(t){c.callbacks[t]&&c.callbacks[t].disconnect()}))},this.useService=function(t,e=[]){const n=t.$serviceState;if(!(n&&n instanceof i))throw new Error("Invalid service provide to useService");const o=n.getStateNames();for(const t of o){if(e&&e.length&&!e.includes(t))continue;const o=n.get(t),r=this.add(t,o.value());o.onUpdate(((t,e)=>{r.set(t),t===e&&r.trigger()}))}},this.set=function(t){let n=!1;for(const o in t){if(void 0===e[o])throw new Error("Undefined State: "+o+" is not declared as state");e[o].set(t[o],!1)&&(n=!0)}n&&u(Object.keys(t))},this.trigger=function(t){u(t)},this.exists=function(t){return void 0!==e[t]},this.getStateWith=function(t){return void 0!==e[t]?this:this.parent?this.parent.getStateWith(t):null},this.getValues=function(t){const e={};return t.forEach((t=>{const n=this.get(t);e[t]=n.value()})),e},this.getAll=function(){return this.getValues(this.getStateNames())},this.get=function(t){return void 0===e[t]&&this.parent?this.parent.get(t):e[t]},this.getStateNames=function(){return Object.keys(e)},this.reset=function(){for(const t of e)t.reset()},this.onUpdate=function(t,e,o=!1){const r=t.filter((t=>!this.exists(t))),i={names:t,listener:e,remove:!1};if(o?n.unshift(i):n.push(i),0===r.length)return e;const c=[];return r.forEach((t=>{const e=this.getStateWith(t);if(!e)return;const n=c.find((({state:t})=>t===e));n?n.variables.push(t):c.push({state:e,variables:[t]})})),0===c.length||c.forEach((({state:t,variables:n})=>{const o={variables:n,state:t};t.onUpdate(n,(()=>{s.enable?e.apply(e,Array.from(arguments)):s.listenersToHandle.add(o)}))})),e},this.removeOnUpdateListener=function(t){const e=n.findIndex((e=>e.listener===t));-1!==e&&n.splice(e,1)},this.unlock=function(){},this.disconnect=function(){n.splice(0),s.listenersToHandle.clear()},this.lock=function(){},(()=>{if(t)for(const e in t)this.add(e,t[e])})()},s=function(t){const e=t.localState??t.componentInstance.getState(),n=t.componentInstance.getActions();this.getRequestedVars=function(t,o=!0){const r=[],i=[],s=t.replace(/('.*?')|(".*?")/g,"").match(/[a-z_0-9$_.]+/gi)?.map((t=>t.split(".").shift().trim())).reduce(((t,e)=>/^[a-z$_]+/i.test(e)?(t.includes(e)||t.push(e),t):t),[]);return s&&s.forEach((t=>{void 0!==e.get(t)?r.push(t):void 0!==n[t]&&i.push(t)})),o?r:{states:r,actions:i}}},c=function(t,e,n=!1,o=!1){const r=this;s.apply(this,[e]);const i=[];let c=e.componentInstance.getState(),u=[],a=null,f={source:null,transformed:null};const h=()=>{i.forEach((t=>{t.apply(t,[this.value()])}))};this.onUpdate=function(t){return i.push(t),t},this.statesToWatch=function(){return u},this.disconnect=function(t){const e=i.indexOf(t);e<0||i.splice(e,1)},this.value=function(t){if(!a)return;const n={};for(const o of u){if(t&&void 0!==t[o]){n[o]=t[o];continue}const r=e.getState(o,f.transformed);r&&(n[o]=r.value())}return a(n)},this.refresh=function(i=null,s=!1){if((i=null===i?t:i)===f.source)return;const l=e.localState||c;if(!0===s&&e.localState&&e.localState.disconnect(),!i)return f.source=i,void(a=null);let p=i.trim().replace(/^\{\{|}}$/g,"").trim();p=function(t){const e=/^([a-z0-9.$_]+)\.\.([a-z0-9.$_]+)$/i;if(e.test(t)){const n=t.match(e);if(n.shift(),2!==n.length)throw new Error("Range error");const[o,r]=n;t="Array.from({ length: "+r+"}, function(value, index) { return index + "+o+"; })"}return u=r.getRequestedVars(t),t}(p);try{let t="return "+p+";";n&&(t=" try { "+t+" } catch(e) { return "+o+"; }"),a=new Function("states",(u.length?"const {"+u.join(",")+"} = states;":"")+t)}catch(t){throw new Error("Syntax error : "+p)}f.transformed=p,f.source=i,s&&h(),u.length&&l.onUpdate(u,h)},(()=>{this.refresh()})()},u=function(t,e){let n=[],o=[],r=null;const i=!n.some((t=>t.hasAState));this.isStateLess=function(){return i},this.each=function(t){n.forEach((e=>{t.apply(t,[e])}))},this.refresh=function(i){i!==r&&(n=(i||t).split(/(\{\{.+?\}\})/).map((t=>{const n=/(^\{\{.+?\}\}$)/.test(t);return{value:t,hasAState:n,template:n?new c(t,e):null}})),o=n.reduce((function(t,e){if(!e.hasAState)return t;return e.template.statesToWatch().forEach((e=>{t.includes(e)||t.push(e)})),t}),[]),r=i)},this.statesToWatch=function(){return o},(()=>{this.refresh(t)})()},a=function(t,e){const n=new c(t,e,!0),o=[],r=function(){o.forEach((t=>{t.apply(t,[!!n.value()])}))};this.watch=function(t){return o.push(t),t},this.isTrue=function(){return!0==!!n.value()},this.trigger=r,this.isFalse=function(){return!1==!!n.value()},this.loadStateWatcher=function(){const t=e.componentInstance.getState();t.removeOnUpdateListener(r),t.onUpdate(n.statesToWatch(),r,!0)},this.refresh=function(t){n.refresh(t),this.loadStateWatcher()},(()=>{this.loadStateWatcher()})()},f=function({$viewDescription:t,$callbacks:e}){const{getIfStatement:n,buildIfStatement:o}=e;this.updateIfControl=function(e){let r=n();if(!r){if(!e)return;return r=o(e),void r.trigger()}r.refresh(e||"true"),r.trigger(),t.if=e}},h=function({$viewDescription:t,$viewProps:e,$isFragment:n}){const o={isRendered:!1,isUnmount:!1,isRemoved:!1};let r=null;const i={anchorsFragment:document.createDocumentFragment(),anchorParent:null,selfFragment:document.createDocumentFragment(),anchor:null,parent:null},s=t=>t?r?null:(r=new a(t,e),r.watch((t=>{e.localState&&(t?e.localState.switchOn():e.localState.switchOff()),t?this.mount():this.unmount()})),r):null;this.render=function(e){e&&!this.isRendered()&&(!0!==n&&s(t.if),this.beforeRenderProcess&&this.beforeRenderProcess(),this.renderProcess(e,r),r&&r.isFalse()?this.setIsUnmounted():this.setIsMounted(),this.setIsRendered())},this.insertAfter=function(t,e){const n=e.nextSibling;e.parentNode&&(n?e.parentNode.insertBefore(t,n):e.parentNode.appendChild(t))},this.mount=function(){o.isUnmount&&this.mountProcess&&this.mountProcess(r)},this.unmount=function(t=!1){o.isUnmount&&!0!==t||this.unmountProcess&&this.unmountProcess(t)},this.remove=function(){o.isRemoved||this.removeProcess&&this.removeProcess()},this.setIsRendered=function(){o.isRendered=!0},this.setIsMounted=function(){o.isUnmount=!1},this.setIsRemoved=function(){o.isRemoved=!0},this.setIsNotRemoved=function(){o.isRemoved=!1},this.setIsUnmounted=function(){o.isUnmount=!0},this.isRendered=function(){return o.isRendered},this.isRemoved=function(){return o.isRemoved},this.setParent=function(t){i.parent=t},this.setAnchor=function(t){i.anchor=t},this.unmountAnchors=function(t,e){i.anchorParent=t,Array.isArray(e)?e.forEach((t=>{i.anchorsFragment.appendChild(t)})):i.anchorsFragment.appendChild(e)},this.mountAnchors=function(){i.anchorParent&&i.anchorParent.appendChild(i.anchorsFragment),i.anchorParent=null},this.moveIntoFragment=function(t){Array.isArray(t)?t.forEach((t=>{i.selfFragment.appendChild(t)})):i.selfFragment.appendChild(t)},this.moveIntoParent=function(t=!1){i.parent||t?i.parent.appendChild(i.selfFragment):i.anchor&&this.insertAfter(i.selfFragment,i.anchor)},this.unMountedFragment=function(){return i.selfFragment},this.getViewDescription=function(){return t},this.updateViewDescription=()=>{},this.updateIfControl=()=>{},f.apply(this,[{$viewDescription:t,$callbacks:{getIfStatement:()=>r,buildIfStatement:s}}])},l=function({$viewDescription:t,$viewDescriptionDetails:e,$htmlTextNodes:n,$textNodes:o,callbacks:r}){const{createConnexion:i,getParentNode:s}=r,c=function(){n.forEach((t=>{t.remove()})),n.splice(0);let t=[...o];e.each((e=>{let r=e.hasAState?e.template.value():e.value;const s=t.find((t=>t.partValue===r)),c=s?s.htmlTextNode:document.createTextNode(r);n.push(c),s?t=t.filter((t=>t===s)):o.push({partValue:r,htmlTextNode:c}),!s&&e.hasAState&&i(c,e)})),(()=>{const t=s();n.forEach((e=>{t.appendChild(e)}))})()};this.updateViewDescription=function(n){n!==t&&(e.refresh(n),c())}},p=function(t,e){h.call(this,{$viewDescription:t,$viewProps:e});const n=new u(t,e),o=[],r=[];let i=null;const s=function(t,e){e.template.onUpdate((e=>{t.textContent=e}))};this.renderProcess=function(t){i=t,this.isRendered()||(n.each((t=>{let e=t.hasAState?t.template.value():t.value;const n=document.createTextNode(e);o.push(n),r.push({partValue:e,htmlTextNode:n}),t.hasAState&&s(n,t)})),this.setParent(t),o.forEach((e=>{t.appendChild(e)})),this.setIsRendered())},this.unmountProcess=function(){this.moveIntoFragment(o),this.setIsUnmounted()},this.mountProcess=function(){this.moveIntoParent(),this.setIsMounted()},this.removeProcess=function(){o.forEach((t=>t.remove())),this.setIsRemoved()},l.apply(this,[{$viewDescription:t,$viewDescriptionDetails:n,$htmlTextNodes:o,$textNodes:r,callbacks:{createConnexion:s,getParentNode:()=>i}}])},d=function(t,e){const n=this;s.apply(this,[e]);let o={};const r=e.localState??e.componentInstance.getState(),i=e.componentInstance.getActions();let c=null,u=null;this.handle=function(t,e=null){c.apply(i,[r,o.states,i,t,e])},this.refresh=function(t){if(t!==u){o=this.getRequestedVars(t,!1),i[t]&&(t+=".apply(actions, (Array.isArray($args) ? $args : [$event]))");try{let e="return "+t+";";const{states:n,actions:r}=o;c=new Function("state","states","actions","$event","$args",(n.length?"const {"+n.join(",")+"} = state.getValues(states);":"")+(r.length?"const {"+r.join(",")+"} = actions;":"")+e),u=t}catch(e){throw new Error("Syntax error : "+t)}}},(()=>{n.refresh(t);const o=()=>{i[t]&&(u=null,this.refresh(t),e.componentInstance.removeControllerUpdatedListener(o))};i[t]||e.componentInstance.onControllerUpdated(o)})()},m=function({$viewDescription:t,$componentEventActions:e,$viewProps:n,$slotManagers:o,$callbacks:r}){const{getProps:i,getElement:s,getHbEvent:u,buildEvent:a,getSlotManagerObject:f}=r;this.updateViewDescription=function(r){!function(e){const o=i();if(!o)return;Object.keys(t.props).forEach((t=>{if(!e[t]){const e=o.getTemplate(t);e&&e.disconnect()}}));const r=s().getState(),u=[];for(const t in e){if(o.exists(t)){u.push(t);continue}const i=new c(e[t],n);o.add(t,i),r.useProps(o,[t])}u.forEach((function(t){o.getTemplate(t).refresh(e[t],!0)}))}(r.props),function(n){const o=u();if(o){Object.keys(t.events).forEach((t=>{const r=e[t];n[t]?r.template.refresh(n[t]):o.removeEventListener(r.name,r.callback)}));for(const t in n){if(e[t])continue;const o=n[t];a(t,o)}}}(r.events),function(e){e.content||e.slots?(t.slots&&Object.keys(t.slots).forEach((t=>{if(!e.slots||!e.slots[t])return o[t].deleteInstances(),void(o[t]=null);o[t].updateViewDescription(e.slots[t])})),e.content?t.content?o.default.updateViewDescription(e.content):o.default=f(e.content):t.content&&(o.default.deleteInstances(),o.default=null),Object.keys(e.slots).forEach((n=>{t.slots[n]||(o[n]=f(e[n]))}))):Object.keys(o).forEach((t=>{o[t].deleteInstances(),o[t]=null}))}(r),function(){const t=i();if(!t)return;const e={};Object.keys(o).forEach((()=>{o[name]&&(e[name]=o[name].builder)})),t.updateSlots(e)}();["content","slots","events","props"].forEach((e=>{t[e]=r[e]}))}},g=function(t,e){h.call(this,{$viewDescription:t,$viewProps:e});const n=document.createComment("");let o=null,i=null,s=null,u={},a={};const f=function(t){const n=[];return{updateViewDescription:function(e){t=e,n.forEach((t=>{t.updateViewDescription(e)}))},deleteInstances:function(){n.forEach((t=>{t.remove()}))},builder:function(o,r){const i=r(t.props),s={...e};i&&(i.parent=e.localState||e.componentInstance.getState(),s.localState=i);const c=new j(t,s);return c.render(o),n.push(c),c}}},l=function(){const e={};if(t.content){const n=f(t.content);e.default=n.builder,a.default=n}if(!t.slots)return e;for(const n in t.slots){const o=f(t.slots[n]);a[n]=o,e[n]=o.builder}return e},p=()=>{const n=e.componentInstance.getActions();if(t.events&&n){s=o.getHbEvent();for(const e in t.events){const n=t.events[e];g(e,n)}}},g=function(t,n){const o=new d(n,e),r=function(){const t=Array.from(arguments);t.push(e.localState),o.handle(null,t)};u[t]={template:o,callback:r,name:t},s.addEventListener(t,r)};this.renderProcess=function(s,u){!function(){const n={};if(t.props)for(const o in t.props)n[o]=new c(t.props[o],e);i=new r(n,l()),o=e.appInstance.createComponentByName(t.component,i),p()}(),s.appendChild(n),u&&u.isFalse()||o.render(s)},this.unmountProcess=function(t){t&&(this.unmountAnchors(n.parentNode,n),!o)||(o.unmount(t),this.setIsUnmounted())},this.mountProcess=function(t){if(this.mountAnchors(),!t||!t.isFalse()){if(o.isRendered())o.mount();else{const t=document.createDocumentFragment();o.render(t),this.insertAfter(t,n)}this.setIsMounted()}},this.removeProcess=function(){n.remove(),o.remove(),this.setIsUnmounted()},this.target=function(){return o?o.getPublicMethod():null},m.apply(this,[{$viewDescription:t,$viewProps:e,$componentEventActions:u,$slotManagers:a,$callbacks:{getProps:()=>i,getElement:()=>o,getHbEvent:()=>s,getSlots:l,buildEvent:g,getSlotManagerObject:f}}])},v=function({$templateDescription:t}){this.disconnect=function(){this.emitUpdate=()=>{}},this.updateValueSource=function(e){t.refresh(e),this.emitUpdate()}},w={style:t=>Object.keys(t).map((e=>e+": "+t[e]+";")).join(" "),class:t=>Object.keys(t).filter((e=>t[e])).join(" ")},y=function(t,e,n,o){const r=new u(n,o),i={onUpdate:[]},s=["value","checked"],c=n=>{e&&(s.indexOf(e)>=0?t[e]=n:t&&"function"==typeof t.setAttribute&&t.setAttribute(e,n))};this.disconnect=()=>{},this.value=function(){const t=[];r.each((n=>{const o=n.hasAState?n.template.value():n.value;if("object"!=typeof o)return void t.push(o);const r=w[e]?w[e].apply(w,[o]):o;t.push(r)}));const n=t.filter((t=>null!=t&&""!==t));return 1===n.length?n[0]:n.join(" ")},this.onUpdate=function(t){i.onUpdate.push(t)},this.emitUpdate=function(){const t=this.value();var e,n;c(t),n=[t],i[e="onUpdate"]&&i[e].forEach((t=>{t.apply(t,n||[])}))},(()=>{c(this.value()),o.componentInstance.getState().onUpdate(r.statesToWatch(),(()=>{this.emitUpdate()}))})(),v.apply(this,[{$templateDescription:r,$callbacks:{updateNodeAttribute:c}}])},b=function(t){this.onBeforeCreate=function(e){return t.beforeCreate.push(e),this},this.onCreated=function(e){return t.created.push(e),this},this.onBeforeMount=function(e){return t.beforeMount.push(e),this},this.onMounted=function(e){return t.mounted.push(e),this},this.onBeforeUnmount=function(e){return t.beforeUnmount.push(e),this},this.onUnmounted=function(e){return t.unmounted.push(e),this},this.onBeforeRemove=function(e){return t.beforeRemove.push(e),this},this.onRemove=function(e){return t.remove.push(e),this},this.onBeforeUpdate=function(e){return t.beforeUpdate.push(e),this},this.onUpdated=function(e){return t.updated.push(e),this},this.clearAll=function(){for(const e in t)t[e].slice()}};b.newListenersStore=function(){return{beforeCreate:[],created:[],beforeMount:[],mounted:[],beforeUnmount:[],unmounted:[],beforeRemove:[],removed:[],beforeUpdate:[],updated:[]}};const E=function(t){const e=(t,e)=>{t.forEach((t=>{t.apply(t,Array.from(e))}))};this.beforeCreate=function(){e(t.beforeCreate,arguments)},this.created=function(){e(t.created,arguments)},this.beforeUnmount=function(){e(t.beforeUnmount,arguments)},this.unmounted=function(){e(t.unmounted,arguments)},this.beforeMount=function(){e(t.beforeMount,arguments)},this.mounted=function(){e(t.mounted,arguments)},this.beforeRemove=function(){e(t.beforeRemove,arguments)},this.removed=function(){e(t.removed,arguments)},this.beforeUpdate=function(){e(t.beforeUpdate,arguments)},this.updated=function(){e(t.updated,arguments)}},S=function(t,e,n,o,r){const i={},s=new b(r);this.get=function(t){return i[t]},function(){for(const u in e){const a=new c(e[u],o),f=o.appInstance.createDirectiveInstance(u,[{element:t,attribute:a,attrs:n}]);for(const t in f){if(void 0===r[t])continue;const e="on"+t[0].toUpperCase()+t.substring(1);s[e].apply(s,[f[t]])}i[u]=f}}()},$="default",I="yield-fragment",A="prevent",R="stop",P=function(t,e,n){const o=[];let r=[...n];const i=[...e];return t.forEach(((t,e)=>{if(t===i[e])return void o.push({node:n[e],viewDescription:t});const s=function(t,e,n){let o=!1;const r=n.find(((n,r)=>{const i=n.getViewDescription();if(o=r===e,"string"==typeof i)return i===t;if(i.key&&i.key===t.key)return!0;if(i.ref&&i.ref===t.ref)return!0;if(JSON.stringify(i)===JSON.stringify(t))return!0;if(i.component&&i.component===t.component)return!0;const{content:s,...c}=i,{content:u,...a}=t;return JSON.stringify(c)===JSON.stringify(a)}));return{isSameIndex:o,element:r}}(t,e,r);if(s.element)return o.push({node:s.element,viewDescription:t}),void(r=r.filter((t=>t!==s.element)));o.push(t)})),o},U=function(t,e){const{content:n,...o}=t,{content:r,...i}=e;return JSON.stringify(o)!==JSON.stringify(i)},D=function({$viewDescription:t,$htmlAttributes:e,$viewProps:n,$htmlEventsStore:o,$callback:r}){const{getChildren:i,getHtmlNode:s,buildEventConnexion:c}=r;this.updateAttributes=function(o){let r={};o&&(r={...o}),Object.keys(e).forEach((t=>{if(!r[t])return s().removeAttribute(t),void e[t].disconnect();e[t].updateValueSource(r[t])}));for(const t in r){if(e[t])continue;const o=s();o&&(e[t]=new y(o,t,r[t],n))}t.attrs=r},this.updateEventHandlers=function(e){let n={};e&&(n={...e}),Object.keys(o).forEach((t=>{n[t]?o[t].updateAction(n[t]):o[t].disconnect()}));for(const t in e)o[t]||c(t,e);t.events=e},this.updateViewDescription=function(e){U(e,t)&&(this.updateAttributes(e.attrs),this.updateEventHandlers(e.events),this.updateIfControl(e.if));const n=i();n&&n.updateViewDescription(e.content),t.content=e.content}},C=function(t,e){if(t.if){const n=new i;n.parent=e.localState||e.componentInstance.getState(),n.if=t.if,e={...e,localState:n}}h.call(this,{$viewDescription:t,$viewProps:e});const n=document.createComment((t.name||"DocumentFragment")+" Anchor "+(t.if?": If ("+t.if+")":"")),o={},r={},s=b.newListenersStore(),c=new E(s);let u=null,a=null,f=null;const l=function(t){if(!t)return null;p(!1);const e=new i;for(const n in o){if(!t.includes(n))continue;const r=e.add(n,o[n].value());o[n].onUpdate((t=>{r.set(t)}))}return e},p=function(n=!0){if(t.attrs)for(const r in t.attrs)o[r]=new y(u,n?r:"",t.attrs[r],e)},m=r=>{!function(){if(t.name!==I)u=t.name?document.createElement(t.name):document.createDocumentFragment(),p(),t.content&&(f=new j(t.content,e)),t.directives&&(a=new S(u,t.directives,o,e,s)),v();else{const n=e.componentInstance.getSlot(t.slot||$);if(u=document.createDocumentFragment(),!n)throw new Error("Undefined Slot name "+t.slot);f=n(u,l)}}(),f&&f.render(u),r.append(u),c.created(),this.setAnchor(n)},g=function(t,n){const o=t.split("."),i=o.pop(),s=n[t],c=new d(s,e),a=function(t){o.includes(A)&&t.preventDefault(),o.includes(R)&&t.stopPropagation(),c.handle(t)};u.addEventListener(i,a),r[t]={name:i,callback:a,disconnect:()=>u.removeEventListener(i,a),updateAction:t=>c.refresh(t)}},v=function(){if(t.events)for(const e in t.events)g(e,t.events)};this.beforeRenderProcess=function(){c.beforeCreate()},this.renderProcess=function(t,e){t.appendChild(n),e&&e.isFalse()||m(t)},this.unmountProcess=function(t){c.beforeUnmount(),t&&(this.unmountAnchors(n.parentNode,n),!u)||(this.moveIntoFragment(u),u instanceof DocumentFragment&&f.unmount(),this.setIsUnmounted(),c.unmounted())},this.mountProcess=function(e){if(this.mountAnchors(),!e||!e.isFalse()){if(c.beforeMount(),(t.content||t.name===I)&&null===f){const t=document.createDocumentFragment();return m(t),this.insertAfter(t,n),void this.setIsMounted()}this.moveIntoParent(),u instanceof DocumentFragment&&(f.mount(),this.insertAfter(u,n)),this.setIsMounted(),c.mounted()}},this.removeProcess=function(){c.beforeRemove(),u?(n.remove(),u.remove(),f&&f.remove(),this.setIsRemoved(),c.removed()):c.removed()},this.target=function(){return u},this.directive=function(){return a},D.apply(this,[{$viewDescription:t,$htmlAttributes:o,$viewProps:e,$htmlEventsStore:r,$callback:{getChildren:()=>f,getHtmlNode:()=>u,buildEventConnexion:g}}])},N=function(t,e){const n={iterableName:null,iterable:null,itemValueName:null,itemKeyName:null};this.test=function(n){return t.test(n)||e.test(n)},this.getExpressionDetails=function(o,r,i){e.test(o)&&(o=o.replace(/\(|\)/g,""));const s=o.match(t);if(!s||s.length<2)return null;const c=s[r+1];n.iterableName=c.split(".").shift(),n.iterable=c;const u=s[i+1].split(",").map((t=>t.trim()));return 1===u.length&&u.unshift("index"),n.itemValueName=u[1],n.itemKeyName=u[0]||"index",n},this.getIterableFullName=function(){return n.iterable},this.getIterableName=function(){return n.iterableName},this.getIterableItemKeyName=function(){return n.itemKeyName},this.getIterableItemValueName=function(){return n.itemValueName}},x=[function(){N.apply(this,[/^([a-z0-9_,\s$]+) in ([a-z0-9_.$]+)$/i,/^\(([a-z0-9_,\s$]+)\) in ([a-z0-9._$]+)$/i]),this.setExpression=function(t){return this.getExpressionDetails(t,1,0)}},function(){N.apply(this,[/^([a-z0-9_.$]+) as ([a-z0-9_,\s$]+)$/i,/^([a-z0-9_.$]+) as \(([a-z0-9_,\s$]+)\)$/i]),this.setExpression=function(t){return this.getExpressionDetails(t,0,1)}}],V=function(t,e){let n=null,o=null,r=null;this.getIterable=function(){return n.value()},this.expressionDescription=function(){return o},this.onUpdate=function(t){return n.onUpdate(t),t},this.refresh=function(t){if(t!==r){t=t.trim().replace(/[\s]+/," ");for(const i of x){const s=new i;if(s.test(t))return s.setExpression(t),o=s,n?n.refresh(o.getIterableFullName()):n=new c(o.getIterableFullName(),e),void(r=t)}throw new Error("Syntax Error : "+t)}},(()=>{this.refresh(t)})()},k=function({$loopTemplate:t,$keyTemplate:e,$viewDescriptionWithoutRepeat:n,$nodeInstancesByKey:o,$callbacks:r}){const{handleLoopExpression:i,getItemKeyName:s,updateIteration:c}=r;this.updateViewDescription=function(r){const{repeat:u,...a}=r;t.refresh(u),i(),e.refresh(r.key||s());const f=a.name&&n.name!==a.name,h=a.component&&n.component!==a.component;f||h?(o.store={},o.current={}):function(t){Object.values(o.store).forEach((({node:e})=>{(t.name&&n.name===t.name||t.component&&n.component===t.component)&&e.updateViewDescription(t)}))}(a),Object.keys(n).forEach((t=>{n[t]=void 0!==a[t]?a[t]:null})),c()}},F=function(t,e){h.call(this,{$viewDescription:t,$viewProps:e,$isFragment:!0});const n=document.createComment("Loop Anchor Start : "+t.repeat),o=document.createComment("Loop Anchor End : "+t.repeat),r={store:{},current:[],last:[]},s={...t};s.repeat=null;const u=new V(t.repeat,e);let a=null,f="",l="",p=new i({[f]:""});p.parent=e.localState??e.componentInstance.getState();const d=new c("",{...e,localState:p});let m=!1;const g=()=>{a=u.expressionDescription(),a&&(f=a.getIterableItemKeyName(),l=a.getIterableItemValueName(),p.add(f,""))},v=()=>{m=!0,this.insertAfter(o,n),y(),u.onUpdate((()=>{y()}))},w=function(t,n){const o={[l]:t[n]};f&&(o[f]=n);const c=d.value(o);if(r.current.push(c),r.store[c]){const t=r.store[c];return t.localState.set(o),void t.node.restoreRef()}const u=new i(o);u.parent=e.localState?e.localState:e.componentInstance.getState();const a=new j(s,{...e,localState:u});r.store[c]={node:a,localState:u}},y=function(){const n=u.getIterable();s.ref&&e.view.cleanReference(t.ref,!0);const o=Array.isArray(n);if(r.last=r.current,r.current=[],o)for(let t=0;t<n.length;t++)w(n,t);else for(const t in n)w(n,t);b()},b=function(){!function(){for(const t of r.last)r.current.includes(t)||(r.store[t].node.remove(),r.store[t]=null)}();for(const t of r.current){if(r.last.includes(t))continue;const e=document.createDocumentFragment(),n=r.store[t].node;n.isRendered()||(n.render(e),o.parentNode&&o.parentNode.insertBefore(e,o))}};this.renderProcess=function(t,e){t.appendChild(n),this.setAnchor(n),e&&e.isFalse()||v()},this.unmountProcess=function(t){this.setParent(null);for(const t of r.current)r.store[t].node.unmount();if(t){const t=[n];let e=n;for(;e.nextSibling!==o;)e=e.nextSibling,e instanceof Comment&&t.push(e);t.push(o),this.unmountAnchors(n.parentNode,t)}this.setIsUnmounted()},this.mountProcess=function(t){if(this.mountAnchors(),!t||!t.isFalse()){if(m)for(const t of r.current)r.store[t].node.mount();else v();this.setIsMounted()}},this.removeProcess=function(){for(const t of r.current)r.store[t].node.remove();n.remove(),o.remove(),this.setIsRemoved()},k.apply(this,[{$loopTemplate:u,$keyTemplate:d,$nodeInstancesByKey:r,$viewDescriptionWithoutRepeat:s,$callbacks:{handleLoopExpression:g,updateIteration:y,getItemKeyName:()=>f}}]),g(),d.refresh(s.key||f)},O=function({$viewDescription:t,$fragmentElements:e,$callbacks:n}){const{handleViewDescriptionElement:o,getParentNode:r,buildViewDescription:i}=n;this.updateViewDescription=function(n,s){if(typeof t!=typeof n)return e.forEach((t=>{t.remove()})),e.splice(0),i(n),void function(t){(t=t||r())&&e.forEach((e=>{e.render(t)}))}(s);const c=e[0];if("string"!=typeof n){if("object"==typeof n)if(Array.isArray(n)){Array.isArray(t)||(t=[]);const i=P(n,t,e);t.splice(0),t.push(...n);const c=[];e.forEach(((t,e)=>{t.unmount(!0);i.find((e=>e?.node===t))||(t.remove(),c.push(t))})),c.forEach((t=>{const n=e.findIndex((e=>e===t));e.splice(n,1)}));let u=[];i.forEach((t=>{if(t?.node&&t.node instanceof j)return t.node.mount(),t.viewDescription?.if?u=[t.viewDescription.if]:t.viewDescription?.elseif&&u.push(t.viewDescription.elseif),void(t.viewDescription&&t.node.updateViewDescription(t.viewDescription));if(t){o(t,u).render(s||r())}}))}else n&&c.updateViewDescription(n)}else c.updateViewDescription(n)}},j=function(t,e){h.call(this,{$viewDescription:t,$viewProps:e,$isFragment:!0});const n=[];let o=null,r=null;const i=function(t,o){if("string"==typeof t){const o=new j(t,e);return n.push(o),o}const r={...t};if(t.if)o.push(t.if);else if(""===t.else){if(0===o.length)throw new Error("Else without If");r.if=M(o)}else if(t.elseif){if(0===o.length)throw new Error("ElseIf without If");r.if=M(o,t.elseif),o.push(t.elseif)}else o.splice(0);const i=new j(r,e);return n.push(i),i},s=function(t){if(!t)return;if("string"==typeof t){const o=new p(t,e);return void n.push(o)}if("object"!=typeof t)return;if(t.repeat){const o=new F(t,e);return void n.push(o)}if(Array.isArray(t))return void function(t){const e=[];for(const n of t)i(n,e)}(t);if(t.component){const r=new g(t,e);return n.push(r),void(t.ref&&(e.view.setReference(t.ref,r),o=r))}const r=new C(t,e);n.push(r),t.ref&&(e.view.setReference(t.ref,r),o=r)};this.build=function(){e.componentInstance&&s(t)},this.restoreRef=function(){o&&t.ref&&e.view.setReference(t.ref,o)},this.renderProcess=function(t){r=t,this.build();for(const e of n)e.render(t)},this.unmountProcess=function(t){for(const e of n)e.unmount(t);this.setIsUnmounted()},this.mountProcess=function(t){if(!t||!t.isFalse()){for(const t of n)t.mount();this.setIsMounted()}},this.removeProcess=function(){for(const t of n)t.remove();this.setIsRemoved()},O.apply(this,[{$viewDescription:t,$fragmentElements:n,$callbacks:{handleViewDescriptionElement:i,buildViewDescription:s,getParentNode:()=>r}}])},L=function(t){return/^\(/.test(t)&&/\)$/.test(t)?t:"("+t.trim()+")"},M=function(t,e=null){const n="!("+t.map(L).join("||")+")";return e?n+" && ("+L(e)+")":n},T=function(){const t=[];this.clean=function(){t.splice(0)},this.push=function(e){t.push(e)},this.get=function(e){return t[e]?.target()},this.props=function(t){const e=[];return this.each((function(n){e.push(n?n[t]:void 0)})),e},this.each=function(e){t.forEach((function(t){e(t.target())}))}},q=function({$viewFragment:t,$viewAnchor:e,$viewAnchorEnd:n}){const o=document.createDocumentFragment();this.putInRenderBox=function(t,e){let n=t.nextSibling;for(;n!==e;){const t=n;n=n.nextSibling,o.appendChild(t)}},this.renderRenderBox=function(t){this.insertAfter(o,t)},this.updateViewDescription=function(r){this.putInRenderBox(e,n),t.updateViewDescription(r,o),this.renderRenderBox(e)}},B=function(t,e){const n=document.createComment(""),o=document.createComment("");let r=null;const i={view:this,appInstance:e,componentInstance:null,localState:null,getState:null};h.call(this,{$viewDescription:t,$viewProps:i});const s=new j(t,i),c={},u={};let a=null;this.renderProcess=function(t,e){r=t,t.appendChild(n),e&&e.isFalse()||(s.render(t),t.appendChild(o))},this.unmountProcess=function(t){t&&this.unmountAnchors(n.parentNode,n),s.unmount(t),this.setIsUnmounted()},this.mountProcess=function(t){if(this.mountAnchors(),!t||!t.isFalse()){if(s.isRendered())s.mount();else{const t=document.createDocumentFragment();s.render(t),this.insertAfter(t,n)}this.setIsMounted()}},this.removeProcess=function(){s.remove(),this.setIsRemoved()},this.setComponentInstance=function(t){i.componentInstance=t,i.getState=function(e){if(this.localState){const t=this.localState.get(e);if(t)return t}return t.getStateByName.apply(i.componentInstance,[e])},a=t,n.textContent=t.getName()+" Component View Anchor",o.textContent=t.getName()+" Component View End Anchor"},this.setReference=function(t,e){const n=function(t){const e={};return["target"].forEach((n=>{t[n]&&(e[n]=function(){return t[n].apply(t,Array.from(arguments))})})),{...e}}(e);if(u[t]instanceof T)return u[t].push(n),void(void 0===c[t]&&Object.defineProperty(c,t,{get:function(){return u[t]}}));u[t]=n,void 0===c[t]&&Object.defineProperty(c,t,{get:function(){return u[t]?.target()}})},this.cleanReference=function(t,e){if(!0===e)return u[t]instanceof T?void u[t].clean():void(u[t]=new T);u[t]=void 0},this.getReferences=function(){return c},this.getComponentInstance=function(){return a},this.getAnchor=function(){return n},q.apply(this,[{$viewFragment:s,$viewAnchor:n,$viewAnchorEnd:o,$callbacks:{getParentNode:()=>r}}])},H=["ref","if","else","elseif","repeat"],_=["fragment","habame"],W=function(t){const e={},n=t.tagName;if(n&&!_.includes(n.toLowerCase())){const t=n[0];t===t.toUpperCase()?e.component=n:e.name=n}if(t.children&&t.children.length>0){const n=[],o=[];Array.from(t.childNodes).forEach((t=>{if(t instanceof Comment)return;const e=W(t);if("slot-fragment"===e.name){if(!e.attrs.name)throw new Error("Slot name is required");return e.props&&(e.props=Object.keys(e.props)),e.name="",void(o[e.attrs.name]=e)}e.name===I&&(e.slot=e.attrs&&e.attrs.name||$),n.push(e)})),e.content=1===n.length?n[0]:n,e.slots=o}else t.textContent&&(e.content=t.textContent);const o=function(t){if(!t.getAttributeNames)return{};const e={};return t.getAttributeNames().forEach((function(n){const o=n.split("."),r=t.getAttribute(n);if(1===o.length)return H.includes(n.toLowerCase())?void(e[n]=r):(e.attrs=e.attrs||{},void(e.attrs[n]=r));const i=o.shift(),s=o.join(".");e[i]||(e[i]={}),e[i][s]=r})),e}(t);if(void 0===e.name&&void 0===e.component&&0===Object.keys(o).length)return e.content;for(const t in o)e[t]=o[t];return e},z=function(t){return JSON.parse(JSON.stringify(t))},K=function(t,e,n){let o=t;const r=t=>{if(n&&n.engines){("string"==typeof n.engines?[n.engines]:n.engines).forEach((e=>{const n=window.Habame.getViewEngine(e);t=n(t)}))}return!0===n.disableXmlEngine||"string"==typeof t&&(t=function(t){if(""===t)return{content:""};let e=t;t instanceof Document||(e=(new DOMParser).parseFromString(`<habame>${t}</habame>`,"application/xhtml+xml"));return e.querySelector("parsererror")?[]:W(e.activeElement)}(t)),t};this.create=function(){const t="string"==typeof o?o:z(o);return new B(t,e)},this.updateViewDescription=function(t){return o=r(t),o},o=r(t)},J=function({$lifecycle:t,$event:e,$componentRequirements:n,$state:o}){const r=[];this.updateController=function(r){const i=o.getAll();t.clearAll(),e.clearAll();for(const t in n.Actions)n.Actions[t]=void 0;r(n);for(const t in i)if(o.exists(t)){const e=o.get(t).value(),n=i[t];if(typeof e!=typeof n)continue;if(Array.isArray(n))continue;o.set({[t]:i[t]})}this.handleListeners()},this.handleListeners=function(){r.forEach((t=>{t&&t()}))},this.onControllerUpdated=function(t){r.push(t)},this.removeControllerUpdatedListener=function(t){const e=r.findIndex((e=>t===e));r.splice(e,1)}},G=function(e,n,o,s,c){const u={},a=new t,f=new i,h=b.newListenersStore(),l=new b(h),p=new E(h),d=n.getReferences();f.parent=c.getState(),f.App=c.getState(),s instanceof r&&f.useProps(s);const m={App:c,Actions:u,HbEvent:a,State:f,Props:s,Lifecycle:l,Refs:d},g=o(m,n);J.apply(this,[{$lifecycle:l,$event:a,$componentRequirements:m,$state:f}]),this.render=function(t){p.beforeCreate(),n.render(t),p.created()},this.getView=function(){return n},this.isRendered=function(){return n.isRendered()},this.unmount=function(t){p.beforeUnmount(),n.unmount(t),p.unmounted()},this.mount=function(){p.beforeMount(),n.mount(),p.mounted()},this.remove=function(){p.beforeRemove(),n.remove(),f.disconnect(),a.disconnect(),p.removed()},this.getStateByName=function(t){return f.get(t)},this.getState=function(){return f},this.getName=function(){return e},this.getActions=function(){return u},this.getHbEvent=function(){return a},this.getSlot=function(t){return s.getSlot(t)},this.getPublicMethod=function(){return g?{...g}:{}},(()=>{for(const t in u)u[t]=u[t].bind(u);n.setComponentInstance(this)})()},X=function(t,e,n,o){const r=[],i={view:n,controller:e,options:o};let s=null;this.create=function(e,n){const c=function(t){return null===s&&(s=new K(i.view,t,o)),s.create()}(n),u=new G(t,c,i.controller,e,n);return r.push({component:u,view:c}),u},this.updateController=function(t){i.controller=t,r.forEach((({component:e})=>{e.updateController(t)}))},this.updateView=function(t){if(i.view=t,!s)return;const e=s.updateViewDescription(t);r.forEach((({view:t})=>{"string"==typeof e||z(e),t?.updateViewDescription(e)}))},this.updateControllerAndView=function(t,e){this.updateController(e),this.updateView(t)}},Q=function(e,n){const o=new t,s=new i,c=(t,e)=>t.create(e,this);this.createDirectiveInstance=function(t,e){return window.Habame.getDirectiveFactory(t).create(e)},this.createComponentByName=function(t,e){const n=t instanceof X?t:window.Habame.getComponentFactory(t);return e=e||new r,c(n,e)},this.getEvent=function(){return o},this.getState=function(){return s},this.getApp=function(t){return n.getApp(t)},this.render=function(t){const n="string"==typeof t?this.createComponentByName(t,null):c(t,null);return n.render(e),n}},Y=function(t,e){this.create=function(t){return new e(...t)}},Z=function(t,e){let n=null;const o=function(){const n=new i,o=Array.isArray(e.params)?e.params:[],r=new t(n,...o);return r.$serviceState=n,r};this.create=function(){return!1===e.isUniqueInstance?o():(n||(n=o()),n)},this.definition=function(){return t}};const tt="Router",et={name:"a",content:{name:"yield-fragment"},attrs:{href:"{{ href }}"},events:{"prevent.click":"push"}};const nt=function(t){return null==t?null:t.replace(/^[/]+/,"").replace(/[/]+$/,"").replace(/[/]+/g,"/").trim()},ot=function(t){const e={required:[],params:{},search:null,hash:null},n=t.groups(),o={name:"",path:null,isUniqueInstance:!0,component:null,redirectTo:null,middlewares:[],where:{}},r=function(t){return{name:t.trim()}};this.params=function(){return{...e.params}},this.hash=function(){return e.hash},this.query=function(){return new URLSearchParams(e.search)},this.router=function(){return t},this.getPath=function(){return o.path},this.isUniqueInstance=function(){return e.isUniqueInstance},this.getState=function(){return{params:this.params(),query:this.query().toString(),hash:this.hash()}},this.path=function(t,e){if(!t&&""!==t)throw new Error("Undefined path");return o.path=n.getPath(nt(t)),e?(o.component=e,this):this},this.name=function(e){return o.name=n.getName(e),t.setNamedRoute(e,this),this},this.dontUseUniqueInstance=function(){return o.isUniqueInstance=!1,this},this.redirectTo=function(t){return o.redirectTo=t,this},this.middlewares=function(){if(0===arguments.length)throw new Error("Route Middlewares : provide the middlewares names");return o.middlewares=n.getMiddlewares(Array.from(arguments)),this},this.where=function(t){return o.where=t,this},this.isMatch=function(t){if(null===o.path)return!1;if(null==t)return!1;const n=new URL(t,location.origin),i=function(){const t=o.path.replace(/\{(.*?)}/g,(function(t,n){const i=r(n);return e.required.push(i),o.where[i.name]?"("+o.where[i.name].replace(/\(/g,"(?:")+")":"(.*?)"}));return new RegExp("^"+t+"$")}(),s=nt(n.pathname);return!!i.test(s)&&(e.search=n.search||null,e.hash=n.hash||null,function(t,n){const o=t.match(n);o.shift();const r={};e.required.forEach(((t,e)=>{r[t.name]=o[e]})),e.params=r}(s,i),!0)},this.getName=function(){return o.name},this.getPath=function(){return o.path},this.getMiddlewares=function(){return o.middlewares||[]},this.getComponent=function(){return o.component},this.set=function(t,n,o){e.params=t,e.search=n||null,e.hash=o||null},this.getUrl=function(t,n,i){t=t||e.params,n=n||e.search,i=i||e.hash;let s=o.path.replace(/\{(.*?)}/g,(function(e,n){const o=r(n);if(void 0===t[o.name])throw new Error("Route param required: "+o.name);return encodeURIComponent(t[o.name])}));return n&&("string"==typeof n&&(s+="?"+n),"object"==typeof n&&(s+="?"+new URLSearchParams(n).toString())),i&&(s+="#"+i),"/"+s}},rt=function(){let t=null,e=[],n=-1;const o=function(){if(n++,!e[n])return;const r=e[n];"function"==typeof r&&r(t,o)};this.handle=function(r,i){t=i,e=r,n=-1,o()}},it=function(){this.push=function(t){const e=t.route;history.pushState({...e.getState(),uuid:t.uuid},"",e.getUrl())},this.back=function(){history.back()},this.forward=function(){history.forward()},this.getCurrentLocation=function(){return location.pathname.replace(/\+$/,"").replace(/^\+/,"")+location.search},this.useService=function(t){window.addEventListener("popstate",(e=>{e.state&&e.state.uuid&&t.moveTo(e.state.uuid)}))}},st={name:"div",ref:"routerRenderContainer",attrs:{id:"{{ id }}"}};var ct={DynamicComponent:function(t){t.createComponent("DynamicComponent",(function({State:t,Props:e,App:n,Lifecycle:o},r){const i={},s={component:null,name:null};t.disconnectProps();const c=function(){const t=e.use;if(!t)throw new Error("Props *use* required");if(s.name!==t){if(s.component&&s.component.unmount(),i[t])i[t].component.mount();else{const o=n.createComponentByName(e.use,e),s=o.getView(),c=document.createDocumentFragment();o.render(c),s.insertAfter(c,r.getAnchor()),i[t]={component:o,fragment:c}}s.component=i[t].component,s.name=t}};e.onUpdate("use",c),o.onCreated(c)}),"")},Link:function(t){t.createComponent("Link",(function({State:e,Props:n,Actions:o}){e.init({href:""});const r=n.router||tt,i=t.Router.getRouter(r);if(!i)throw new Error("Undefined Router "+(n.router||tt));if(n.to&&!i.routeExists(n.to))throw new Error("Undefined route name "+n.to);const s=function(){if(n.to){const t=i.getRouteByName(n.to);return t.set(n.params||{},n.query,n.hash),t}return i.getRouteByPath(n.href)},c=function(){const t=s();e.href=t.getUrl()};o.push=function(){const t=s();i.push(t)},c(),n.to?n.onUpdate("to",(()=>c())):n.href&&n.onUpdate("href",(()=>c()))}),et)},Router:function(t){t.createComponent("Router",(function({Props:e,State:n,Refs:o,App:r,Lifecycle:i}){n.init({id:e.id||""});const s=new rt,c={},u=t.Services[e.name||tt];n.useService(u);let a=null;const f=function(t){if(!o.routerRenderContainer)return;let e=t.getPath();if(t.isUniqueInstance()||(e=t.getUrl()),c[e])return a=c[e],a.mount(),c[e];a=r.createComponentByName(t.getComponent(),null),c[e]=a,a.render(o.routerRenderContainer)};n.get("$route").onUpdate((t=>{if(a&&a.unmount(),!(t instanceof ot))return;const e=t.getMiddlewares();e.push(f),s.handle(e,t)})),i.onCreated((()=>{const t=u.historyHandler();t&&"function"==typeof t.getCurrentLocation?(u.push(t.getCurrentLocation()),t instanceof it&&t.useService(u)):u.push("/")}))}),st)}};const ut=function(t){const e={prefix:null,name:null,middlewares:[]};this.prefix=function(t){return e.prefix=t,this},this.name=function(t){return e.name=t,this},this.middlewares=function(){return e.middlewares=Array.from(arguments),this},this.getName=function(){return e.name},this.getPrefix=function(){return e.prefix},this.getMiddlewares=function(){return e.middlewares},this.group=function(e){t.groups().addGroup(this),e(),t.groups().removeGroup(this)}},at=function(){let t=[];this.addGroup=function(e){t.push(e)},this.removeGroup=function(e){t=t.filter((t=>e!==t))},this.getName=function(e){const n=[];return t.forEach((t=>{const e=t.getName();e&&n.push(e)})),e&&n.push(e),n.join("")},this.getPath=function(e){const n=[];return t.forEach((t=>{const e=t.getPrefix();e&&n.push(e)})),e&&n.push(e),n.join("/")},this.getMiddlewares=function(e){let n=[];return t.forEach((t=>{const e=t.getMiddlewares();e&&(n=n.concat(e))})),e&&(n=n.concat(e)),n}},ft=function(t,e){const n=new at,o={},r=[];let i=null,s=null;this.setNamedRoute=function(t,e){o[t]=e},this.getRouterService=function(){return s||(s=e.Services[t],s)},this.path=function(t,e){const n=new ot(this);return n.path(t,e),r.push(n),n},this.notFound=function(t,e){const n=new ot(this);n.path(t,e),i=n},this.prefix=function(t){return new ut(this).prefix(t)},this.name=function(t){return new ut(this).name(t)},this.middlewares=function(){return new ut(this).middlewares(...arguments)},this.groups=function(){return n},this.routeExists=function(t){return void 0!==o[t]},this.getRouteByName=function(t){if(!o[t])throw new Error("Undefined route "+t);return o[t]},this.getRouteByPath=function(t){const e=nt(t);for(const t of r)if(t.isMatch(e))return t;if(!i)throw new Error("Route not found: "+t);return i},this.get=function(t){if(t instanceof ot)return t;if("object"==typeof t){const e=this.getRouteByName(t.name);if(e)return e.set(t.params,t.query,t.hash),e}if("string"==typeof t){const e=this.getRouteByPath(t);if(e)return e}return i},this.push=function(t){if(!t)throw new Error("Router.push params require a valid param");const e=this.get(t);if(!e)throw new Error("Route not found");this.getRouterService().pushRoute(e)}},ht=function(t,e,n){const o=[],r=[];let i=-1,s=null;t.init({$route:null});const c=function(t){const e=o[t],n=e.state;return e.route.set(n.params,n.query,n.hash),e};this.onChange=function(t){if("function"==typeof t)throw new Error("onChange require a function, "+typeof t+" given");r.push(t)},this.historyHandler=function(){return n},this.pushRoute=function(e){if(!(e instanceof ot))return;const c=(new Date).getTime(),u={route:e,state:e.getState(),url:e.getUrl(),uuid:c};o.splice(i+1),o.push(u),i++,n&&n.push(u);const a=t.$route===e&&s!==u.url;t.$route=e,s=u.url,a&&t.get("$route").trigger(),function(t){r.forEach((e=>{e(t)}))}(e)},this.push=function(t){this.pushRoute(e.get(t))},this.moveTo=function(e){let n=null;o[i-1]?.uuid===e?(i--,n=o[i]):o[i+1]?.uuid===e&&(i++,n=o[i]),n&&(t.$route=n.route)},this.back=function(){if(i-1<0)return;i--;const e=c(i);n&&n.back(e.route),t.$route=e.route},this.forward=function(){if(!o[i+1])return;i++;const e=c(i);n&&n.forward(e.route),t.$route=e.route}},lt=function(){const t={},e={},n={},o={};let r={},i=null;const s={Services:{},createRoot:function(t,e=null){const n=new Q(t,s);return e&&(o[e]=n),n},setDefaultViewEngine:function(t,e){e&&this.addViewEngine(t,e),i=t},addViewEngine:function(t,e){if(void 0===r[t]){if("function"!=typeof e)throw new Error("View Engine "+t+" must be a function");r[t]=e}},getViewEngine:function(t){return r[t]},createComponent:function(e,n,o,r={}){r.engines=r.engines||i;const s=new X(e,n,o,r);return t[e]=s,s},createService:function(t,e,o){const r=new Z(e,o||{});n[t]=r,Object.defineProperty(lt.Services,t,{get:()=>r.create()})},getServices:function(){return n},getComponentFactory:function(e){const n=t[e];if(!n)throw new Error("Component "+e+" not found");return n},createDirective:function(t,n){const o=new Y(t,n);return e[t]=o,o},getDirectiveFactory:function(t){const n=e[t];if(!n)throw new Error("Directive "+t+" not found");return n},getApp:function(t){return o[t]}};s.Router=function(t){const e={};return{createRouter:function(n,o){if(e[n=n||tt]instanceof ft)throw new Error("router : "+n+" already exists");const r=new ft(n,t);let i=null;return o&&!0===o.browserHistory?i=new it:o&&o.history&&(i=o.history),t.createService(tt,ht,{params:[r,i]}),e[n]=r,r},createBrowserRouter:function(){return t.Router.createRouter(null,{browserHistory:!0})},getRouter:function(t){if(!(e[t=t||tt]instanceof ft))throw new Error("Undefined router "+t);return e[t]}}}(s);const c=Object.values(ct);for(const t of c)"function"==typeof t&&t(s);return s}();return lt}();
